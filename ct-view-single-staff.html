<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-input/paper-input-behavior.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-material/paper-material.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">

<link rel="import" href="../iron-form/iron-form.html">
<link rel="import" href="../ct-shared-styles/ct-application-theme.html">
<link rel="import" href="../ct-editable-switcher/ct-editable-switcher.html">

<!--
`ct-view-single-staff`
View a single staff member

@demo demo/index.html
-->

<dom-module id="ct-view-single-staff">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <template>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <style is="custom-style">
      :host {
        --paper-input-error: {
          color:#00ff00;
        };

        --paper-input-container:  {
          border-top:1px solid #ccc;
          border-left:1px solid #ccc;
          border-right:1px solid #ccc;
          border-bottom: none;
          padding: 0;
          margin-bottom: 24px;
        };

        /*padding to move from border */
        --paper-input-container-input: {
          padding-left: 10px;
          left: auto;
        };

        --paper-input-container-label: {
          margin-left: 10px;
        };
        --paper-input-container-label-floating: {
          margin-left: 10px;
        };

        --paper-input-error: {
          left: auto !important;
          right: 20px !important;
          font-style: italic;
        };

        --paper-icon-button-ink-color: var(--breadcrumb-icon-color-ripple);
      }
      /* ### FONTS
          @font-face {font-family: Avenir;
              src: url(../fonts/avenir-lt-std-65-medium-58904de1bad61.otf);
            /*  src: url("https://db.onlinewebfonts.com/t/2184e38751bd90baea505aef3f313bda.eot?#iefix") format("embedded-opentype"),
              url("https://db.onlinewebfonts.com/t/2184e38751bd90baea505aef3f313bda.woff2") format("woff2"),
              url("https://db.onlinewebfonts.com/t/2184e38751bd90baea505aef3f313bda.woff") format("woff"),
              url("https://db.onlinewebfonts.com/t/2184e38751bd90baea505aef3f313bda.ttf") format("truetype"),
              url("https://db.onlinewebfonts.com/t/2184e38751bd90baea505aef3f313bda.svg#Avenir") format("svg");
              * /
          }

          @font-face {
            font-family: avenirbl;
            src: url(../fonts/avenir-lt-95-black-589044956bd1d.ttf);
          }
          @font-face {
            font-family: avenirmd;
            src: url(../fonts/avenir-lt-std-65-medium-58904de1bad61.otf);
          }
          @font-face {
            font-family: avenirrg;
            src: url(../fonts/avenir-next-w01-thin-58904b7a2923f.ttf);
          }
      */


      /* local color for button */
      paper-button.fancy {
        margin-top: 3px;

      }
      /*local dropdown menu */
      paper-dropdown-menu.custom-dropdown {
        width: 100%;
        --paper-input-container: {
          border-top:1px solid #ccc;
          border-left:1px solid #ccc;
          border-right:1px solid #ccc;
          border-bottom: none;
          padding: 0;
          margin-bottom: 8px;
        };
        --paper-input-container-input: {
          padding-left: 10px;
        };
      }


    .primary-box-container {
      background: #3d3d3d;
      margin-bottom: 40px;

    }
    .primary-box-container h3 {
      color: #ffffff;
      margin: 10px 0;
    }

    .breadcrumb-icon {
        --paper-icon-button-ink-color: {#fff !important;};
    }

    .main-section .primary-box-container h3 {
      font-size: 20px;
      line-height: 21px;
      padding: 0 15px;
    }


    </style>

    <div class="main-section">
      <div class="container-fluid">
      <div class="row">
        <div class="col-xs-12 primary-box-container">
          <div class="row">
            <div class="col-xs-12 col-sm-8">
              <h3 class="ct-header">[[userData.firstName]]&nbsp;[[userData.lastName]]</h3>
            </div>
            <div class="col-xs-12 col-sm-4">
              <paper-button class="fancy margin-10v pull-right btn btn-danger" on-tap="_openDeleteModal">Delete</paper-button>
              <paper-button class$="fancy margin-10v pull-right btn [[_computeBtnStyle(_isStateEdit)]]" on-tap="_editBtnHandler">[[_computeButtonText(_isStateEdit)]]</paper-button>
            </div>
          </div>
        </div>
      </div>

        <form class="" is="iron-form">
          <div class="row">

            <div class="col-sm-6 col-xs-12">
              <div class="form-group">
                <ct-editable-switcher edit-mode$="[[_isStateEdit]]">
                  <paper-input
                          class="input-element"
                          autocapitalize
                          label="First Name"
                          type="text"
                          name="firstName"
                          value="[[userData.firstName]]"
                          required
                          auto-validate
                          error-message="Please provide a first name"></paper-input>
                </ct-editable-switcher>

              </div>
            </div>
            <div class="col-sm-6 col-xs-12">
              <div class="form-group">
                <ct-editable-switcher edit-mode$="[[_isStateEdit]]">
                  <paper-input
                          class="input-element"
                          label="Last Name"
                          type="text"
                          name="lastName"
                          value="[[userData.lastName]]"
                          required
                          auto-validate
                          error-message="Please provide a last name"></paper-input>
                </ct-editable-switcher>
              </div>
            </div>
            <div class="col-sm-6 col-xs-12">
              <div class="form-group">
                <ct-editable-switcher edit-mode$="[[_isStateEdit]]">
                  <paper-input
                          class="input-element"
                          label="Email"
                          type="email"
                          name="email"
                          value="[[_computeContact( 'email', userData.contact)]]"
                          required
                          auto-validate
                          error-message="Please enter a valid email address"></paper-input>
                </ct-editable-switcher>
              </div>
            </div>
            <div class="col-sm-6 col-xs-12">
              <div class="form-group">
                <ct-editable-switcher edit-mode$="[[_isStateEdit]]">
                  <paper-input
                          class="input-element"
                          label="Mobile"
                          type="text"
                          prevent-invalid-input
                          name="mobile"
                          value="[[_computeContact( 'email', userData.contacts)]]"
                          auto-validate
                          pattern="[0-9 +]"
                          char-counter
                          error-message="Numbers only"></paper-input>
                </ct-editable-switcher>
              </div>
            </div>
            <div class="col-sm-6 col-xs-12">
              <div class="form-group">
                <ct-editable-switcher edit-mode$="[[_isStateEdit]]">
                  <paper-dropdown-menu
                          class="input-element"
                          label="Staff Group"
                          noink
                          no-animations
                          required
                          placeholder="Please select a staff group">
                    <paper-listbox class="dropdown-content" selected="{{userData.group}}" attr-for-selected="key">
                      <template is="dom-repeat" items="{{userGroups}}">
                        <paper-item key="[[item.id]]">[[item.name]]</paper-item>
                      </template>
                    </paper-listbox>
                  </paper-dropdown-menu>
                </ct-editable-switcher>
              </div>
            </div>
          </div>

        </form>

        <!--todo: integrate with zendesk for ticketing-->
        <!--<div class="container-fluid">-->
        <!--<div class="row">-->
        <!--<div class="col-xs-12">-->
        <!--<div class="row">-->
        <!--<h5>Filter</h5>-->
        <!--<div class="col-xs-12 col-sm-4">-->
        <!--<paper-input label="To" placeholder="Search for building name, address, status" type="text" name="To" value="" auto-validate pattern="[a-zA-Z 0-9]*" error-message="Require letters and numbers"></paper-input>-->
        <!--</div>-->
        <!--<div class="col-xs-12 col-sm-4">-->
        <!--<paper-input label="From" placeholder="Search for building name, address, status" type="text" name="From" value="" auto-validate pattern="[a-zA-Z 0-9]*" error-message="Require letters and numbers"></paper-input>-->
        <!--</div>-->
        <!--<div class="col-xs-4 col-sm-2">-->
        <!--<paper-button class="fancy" type="button" name="button">Filter</paper-button>-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->


      <!--<div class="row">-->
      <!--<div class="col-xs-12">-->
      <!--<div class="table-responsive">-->
      <!--<table class="table table-striped table-bordered table-hover">-->
      <!-- <thead>-->
      <!--<tr>-->
      <!--<th>Ticket Ref</th>-->
      <!--<th>Time Start</th>-->
      <!--<th>Time End</th>-->
      <!--<th>Duration</th>-->
      <!--<th>Status</th>-->
      <!--</tr>-->
      <!--</thead> -->
      <!--<tbody>-->
      <!--<tr class="success">-->
      <!--<th scope="row">1234567890</th>-->
      <!--<td>2017 / 01 / 01 12:00</td>-->
      <!--<td>2017 / 01 / 01 13:00</td>-->
      <!--<td>50s</td>-->
      <!--<td>Resolved</td>-->
      <!--</tr>-->
      <!--<tr class="warning">-->
      <!--<th scope="row">1234567890</th>-->
      <!--<td>2017 / 01 / 01 12:00</td>-->
      <!--<td>2017 / 01 / 01 13:00</td>-->
      <!--<td>50s</td>-->
      <!--<td>Escalated</td>-->
      <!--</tr>-->
      <!--<tr class="success">-->
      <!--<th scope="row">1234567890</th>-->
      <!--<td>2017 / 01 / 01 12:00</td>-->
      <!--<td>2017 / 01 / 01 13:00</td>-->
      <!--<td>50s</td>-->
      <!--<td>Resolved</td>-->
      <!--</tr>-->
      <!--<tr class="info">-->ct-view-single-staff.html
      <!--<th scope="row">1234567890</th>-->
      <!--<td>2017 / 01 / 01 12:00</td>-->
      <!--<td>2017 / 01 / 01 13:00</td>-->
      <!--<td>50s</td>-->
      <!--<td>In Progress</td>-->
      <!--</tr>-->
      <!--<tr class="info">-->
      <!--<th scope="row">1234567890</th>-->
      <!--<td>2017 / 01 / 01 12:00</td>-->
      <!--<td>2017 / 01 / 01 13:00</td>-->
      <!--<td>50s</td>-->
      <!--<td>In Progress</td>-->
      <!--</tr>-->
      <!--</tbody>-->
      <!--</table>-->
      <!--</div>-->
      <!--<nav aria-label="Page navigation">-->
      <!--<ul class="pager">-->
      <!--<li>-->
      <!--<a href="#" aria-label="Previous">-->
      <!--<span aria-hidden="true">&laquo;</span>-->
      <!--</a>-->
      <!--</li>-->
      <!--<li><a href="#">1</a></li>-->
      <!--<li><a href="#">2</a></li>-->
      <!--<li><a href="#">3</a></li>-->
      <!--<li><a href="#">4</a></li>-->
      <!--<li><a href="#">5</a></li>-->
      <!--<li>-->
      <!--<a href="#" aria-label="Next">-->
      <!--<span aria-hidden="true">&raquo;</span>-->
      <!--</a>-->
      <!--</li>-->
      <!--</ul>-->
      <!--</nav>-->
      <!--</div>-->
      <!--</div>-->

    </div> <!-- Staff table Container -->
</div>
    <paper-dialog
            id="deleteModal"
            modal
            on-iron-overlay-opened="_patchOverlay">
      <h2>Confirm Delete</h2>
      <p>Are you sure you want to delete this staff member?</p>
      <div class="buttons">
        <paper-button class="btn btn-link" dialog-dismiss>Cancel</paper-button>
        <paper-button class="btn btn-primary" on-tap="_deleteUser" autofocus raised>Delete</paper-button>
      </div>
    </paper-dialog>

  </template>

  <script>
      Polymer({

          is: 'ct-view-single-staff',

          properties: {
              userData : Object,
              _isStateEdit: {
                  type: Boolean,
                  value: function(){ return false; }
              },
              userGroups : Array,
          },

          listeners : {
              'iron-form-presubmit': '_formHandler'
          },

          _openDeleteModal : function(){
              this.$.deleteModal.open();
          },

          _deleteUser : function(){
              this.fire('deleteStaff', this.userData.id);
          },

          _computeButtonText: function(isEdit){
              return (isEdit) ? 'Save Details' : 'Edit Details';
          },

          _computeBtnStyle : function(isEdit){
              return (isEdit) ? "btn-success" : "btn-primary";
          },

          _toggleStatus : function(){
              this._isStateEdit = !this._isStateEdit;
          },

          _computeContact : function(type, contactData) {
              console.log(contactData);
              var data = contactData.filter(function(o){
                  return (o.contact.contactType[0].toLowerCase() === type);
              })[0];

              return (data) ? data.contact.contact : 'Not Available';
          },


          _editBtnHandler : function(){
              var form = this.$$('form');
              if(this._isStateEdit){
                  if(form.validate()){
                      form.submit();
                  }
              } else {
                  this._toggleStatus();
              }
          },

          _formHandler : function(e){
              var form = this.$$('form');

              e.preventDefault();

              this.fire('editStaff', form.serialize());
              this._toggleStatus();
          },

          _patchOverlay: function (e) {
              if (e.target.withBackdrop) {
                  e.target.parentNode.insertBefore(e.target.backdropElement, e.target);
              }
          },


      });
  </script>
</dom-module>
